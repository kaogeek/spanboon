<!--
    @license Spanboon Platform v0.1
    (c) 2020-2021 KaoGeek. http://kaogeek.dev
    License: MIT. https://opensource.org/licenses/MIT
    Author:  p-nattawadee <nattawdee.l@absolute.co.th>, Chanachai-Pansailom <chanachai.p@absolute.co.th>, Americaso <treerayuth.o@absolute.co.th>
-->

<div class="repost-data-card" [ngStyle]="isRepost? {'max-height': '60vh'} : {'max-height': 'none'}" *ngIf="itemPost">
    <div class="profile-page" *ngIf="!itemPost.requester">
        <ng-container
            *ngIf="itemPost.pageId !== undefined && itemPost.pageId !== null && itemPost.pageId.imageURL && itemPost.pageId.imageURL !== undefined && itemPost.pageId.imageURL !== null && itemPost.pageId.imageURL !== '' ; else elseImage">
            <div class="menu-user" (click)="menuProfile();">
                <img class="image-profile" src="{{itemPost.pageId.imageURL}}" alt="">
            </div>
        </ng-container>
        <ng-template #elseImage>
            <div *ngIf="itemPost.pageId !== undefined && itemPost.pageId !== null && itemPost.pageId && itemPost.pageId !== undefined && itemPost.pageId !== null && itemPost.pageId !== ''"
                class="menu-user displayName">
                <div class="donator">
                    {{itemPost.pageId.name | slice: 0:1 }}
                </div>
            </div>
        </ng-template>
        <div *ngIf="itemPost.pageId !== undefined && itemPost.pageId !== null && itemPost.pageId && itemPost.pageId !== undefined && itemPost.pageId !== null && itemPost.pageId !== ''"
            class="profile-page-name">
            {{itemPost.pageId.name}}
            <span class="profile-page-name-sub" (click)="postTeb(itemPost)">{{itemPost && itemPost.createdDate |
                dateFormat}}</span>
        </div>
    </div>
    <div class="fulfill-profile" *ngIf="itemPost.requester"
        [class.active]="itemPost.gallery && itemPost.gallery.length === 0 && itemPost.title === '' ">
        <div class="fufill-name">
            <div class="left">
                <a href="/profile/{{itemPost.requester && itemPost.requester.uniqueId !== '' && itemPost.requester.uniqueId !== undefined && itemPost.requester.uniqueId !== null ? itemPost.requester.uniqueId : itemPost.requester && itemPost.requester._id}}"
                    target="_blank">
                    <div class="profile-left">
                        <ng-container
                            *ngIf="itemPost.requester && itemPost.requester.imageURL && itemPost.requester.imageURL !== undefined && itemPost.requester.imageURL !== '' && itemPost.requester.imageURL !== null; else elseTemplateImage">
                            <img class="post-data-profile" src="{{apiBaseURL + itemPost.requester.imageURL+'/image'}}"
                                alt="">
                        </ng-container>
                        <ng-template #elseTemplateImage>
                            <img class="post-data-profile" src="../../../../assets/img/profile1.svg" alt="">
                        </ng-template>
                        <div class="name-top">
                            <div class="fulfill-name">{{itemPost.requester && itemPost.requester.displayName}}
                            </div>
                            <div class="text">ผู้ร่วมเติมเต็ม</div>
                        </div>
                    </div>
                </a>
                <div class="middle">
                    <svg class="icon-fulfill" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" version="1.1"
                        width="20" height="20" x="0" y="0" viewBox="0 0 488.07 488.071"
                        style="enable-background:new 0 0 512 512" xml:space="preserve">
                        <g transform="matrix(1,0,0,1,0,0)">
                            <g xmlns="http://www.w3.org/2000/svg">
                                <g id="SvgjsG1006">
                                    <path
                                        d="M238.986,244.034c0,6.895-3.683,13.276-9.654,16.723L28.958,427.954c-5.971,3.452-13.333,3.452-19.306,0    C3.68,424.5,0,418.13,0,411.23V76.832c0-6.892,3.675-13.27,9.652-16.723c2.988-1.723,6.321-2.583,9.655-2.583    c3.341,0,6.663,0.864,9.655,2.583l200.379,167.2C235.304,230.759,238.986,237.137,238.986,244.034z M478.429,227.314    l-200.386-167.2c-2.978-1.724-6.312-2.583-9.651-2.583s-6.653,0.864-9.654,2.583c-5.973,3.453-9.652,9.825-9.652,16.723v334.4    c0,6.893,3.68,13.271,9.652,16.721c5.976,3.447,13.33,3.447,19.306,0l200.373-167.202c5.976-3.441,9.654-9.816,9.654-16.717    C488.08,237.142,484.392,230.759,478.429,227.314z"
                                        fill="#84b572" data-original="#000000" style="" class="" />
                                </g>
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                            <g xmlns="http://www.w3.org/2000/svg">
                            </g>
                        </g>
                    </svg>
                </div>
                <a href="/page/{{itemPost.pageId}}" target="_blank">
                    <div class="profile-right">
                        <ng-container
                            *ngIf="itemPost.fulfillmentPage && itemPost.fulfillmentPage.imageURL && itemPost.fulfillmentPage.imageURL !== undefined && itemPost.fulfillmentPage.imageURL !== '' && itemPost.fulfillmentPage.imageURL !== null; else elseTemplateImagePage">
                            <img class="post-data-profile"
                                src="{{apiBaseURL + itemPost.fulfillmentPage.imageURL+'/image'}}" alt="">
                        </ng-container>
                        <ng-template #elseTemplateImagePage>
                            <img class="post-data-profile" src="../../../../assets/img/profile1.svg" alt="">
                        </ng-template>
                        <div class="name-top">
                            <div class="fulfill-name">{{itemPost.fulfillmentPage && itemPost.fulfillmentPage.name}}
                            </div>
                            <ng-container
                                *ngIf="itemPost.objectiveTag && itemPost.objectiveTag !== null && itemPost.objectiveTag !== undefined && itemPost.objectiveTag !== ''; else elseTemplateObjective">
                                <div class="text">สิ่งที่กำลังทำ</div>
                            </ng-container>
                            <ng-template #elseTemplateObjective>
                                <div class="text">เพจที่มองหา</div>
                            </ng-template>

                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <ng-container *ngIf="isNotAccess">
        <ng-container *ngIf="itemPost">
            <button mat-icon-button [matMenuTriggerFor]="menu" [disableRipple]="'false'" class="dropdown">
                <span class="material-icons">
                    more_horiz
                </span>
            </button>
            <mat-menu #menu="matMenu" xPosition="before">
                <button mat-menu-item [disableRipple]="'true'" class="list-dropdown">
                    <mat-icon>edit</mat-icon>
                    <span>แก้ไข</span>
                </button>
                <button mat-menu-item [disableRipple]="'true'" class="list-dropdown" (click)="deletePost(itemPost)">
                    <mat-icon>delete</mat-icon>
                    <span>ลบ</span>
                </button>
            </mat-menu>
        </ng-container>
    </ng-container>

    <ng-container *ngIf="itemPost.gallery && itemPost.gallery.length > 0">
        <display-gallery [gallery]="itemPost.gallery" (clickShowImage)="showDialogGallery($event)"></display-gallery>
    </ng-container>
    <div class="topic-name" [class.active]="itemPost.referencePostObject"
        *ngIf="itemPost.title === '' || itemPost.title === undefined || itemPost.title === null  ">
        <div class="name" *ngIf="itemPost.requester">
            {{itemPost.requester && itemPost.requester.displayName}} เต็มเติมให้กับ
            {{itemPost.fulfillmentPage && itemPost.fulfillmentPage.name}}
        </div>
    </div>

    <div class="wrapper-content"
        [class.active]="(itemPost.type === 'FULFILLMENT' && itemPost.title !== '' && itemPost.title !== undefined && itemPost.title !== null) || (itemPost.type === 'NEEDS' && itemPost.gallery && itemPost.gallery.length === 0) || (itemPost.type === 'GENERAL' && itemPost.title !== '' && itemPost.detail !== '' && itemPost.gallery && itemPost.gallery.length === 0 || (itemPost.title === '' || itemPost.detail === ''))">
        <!-- <ng-container *ngIf="itemPost.type === 'NEEDS';">
            <div class="left">
                <div class="icon-feed looking"></div>
                <span>
                    มองหา
                </span>
                <div class="post-to">
                    <div class="date-time" [phxPreload]="itemPost" [preloadClass]="'date-time'">
                        <span style="cursor: pointer;" (click)="postTeb(itemPost)">{{itemPost &&
                            itemPost.createdDate | dateFormat}}</span>
                    </div>
                    <ng-container *ngIf="isPage">
                        <div class="post-name">
                                เผยแพร่โดย :
                                <span>Natthaphong Ruengpanyawut</span>
                            </div>
                    </ng-container>
                </div>
            </div>
        </ng-container> -->
        <div class="title" *ngIf="itemPost && itemPost.title">
            {{itemPost && itemPost.title}}
        </div>
        <div class="content" *ngIf="itemPost && itemPost.detail" [innerHTML]="itemPost && itemPost.detail">
        </div>
        <div class="page-give" *ngIf="isFulfill"
            [class.active]="itemPost.gallery.length === 0 && itemPost.title !== '' && itemPost.title !== null && itemPost.title !== undefined ">
            <span>ร่วมเติมเต็มให้กับ</span>
            <a target="_blank"
                matTooltip="{{itemPost.casePostId && itemPost.casePostId !== undefined && itemPost.casePostId !== '' ? webBaseURL+'/post/'+itemPost.casePostId : webBaseURL+'/page/'+itemPost.pageId }}"
                href="{{itemPost.casePostId && itemPost.casePostId !== undefined && itemPost.casePostId !== '' ? webBaseURL+'/post/'+itemPost.casePostId : webBaseURL+'/page/'+itemPost.pageId }}">
                {{itemPost.casePostId && itemPost.casePostId !== undefined &&
                itemPost.casePostId !== '' ?
                'โพสต์' : 'เพจ' }} </a>
        </div>

        <a *ngIf="itemPost.likeMainPost" href={{itemPost.likeMainPost}} target="_blank">
            <div class="content-sub">
                ไปที่โพสต์ต้นทาง
            </div>
        </a>

        <ng-container *ngIf="itemPost.story">
            <div (click)="storyTeb(itemPost)" class="content-sub">
                อ่านเพิ่มเติม<span style="margin-left: 1px;">...</span>
            </div>
        </ng-container>

        <div class="tag_div" *ngIf="itemPost.hashTags && itemPost.hashTags.length > 0" [routerLink]="'/'">
            <div class="h_tag_list" *ngFor="let hashTag of itemPost.hashTags">
                <a class="highlight-text" href="/hashtag/{{hashTag}}">#{{hashTag.name}}</a>
            </div>
        </div>

        <needs-card [itemNeeds]="itemPost.needs" [isFulfillQuantity]="true" [isFulfill]="isFulfill"
            [isPendingFulfill]="isPendingFulfill"
            [isImage]="itemPost.gallery && itemPost.gallery.length > 0 && itemPost.title === '' "></needs-card>

        <ng-template #elseNullPost>
            <ng-container>
                <null-data></null-data>
            </ng-container>
        </ng-template>
        <!-- <div class="wrapper-footer-post">
            <div class="left">
                
        <div class="group-event" [phxPreload]="itemPost" [preloadClass]="'group-event'">
            <div class="event-tag" [ngStyle]="{'display': isEmptyObject(itemPost.emergencyEvent) ? 'flex' : 'none'}">
                <svg class="icon-event" xmlns="http://www.w3.org/2000/svg" width="23" height="21" viewBox="0 0 23 21">
                    <g id="Group_1312" data-name="Group 1312" transform="translate(-672.701 -415.463)">
                        <path id="Subtraction_2" data-name="Subtraction 2"
                            d="M-6438.83,1006.048h-12.47V999.7a6.241,6.241,0,0,1,6.235-6.233,6.241,6.241,0,0,1,6.235,6.233v6.351Zm-5.186-11.363a5.776,5.776,0,0,0-3.925,1.269,5.394,5.394,0,0,0-1.9,4.091.55.55,0,0,0,.583.563.55.55,0,0,0,.583-.563,4.24,4.24,0,0,1,1.561-3.267,4.628,4.628,0,0,1,3.1-.928.55.55,0,0,0,.563-.583A.55.55,0,0,0-6444.015,994.686Z"
                            transform="translate(7129.611 -573.082)" fill="#FD545A" stroke="rgba(0,0,0,0)"
                            stroke-miterlimit="10" stroke-width="1" />
                        <path id="Rectangle_572" data-name="Rectangle 572"
                            d="M2,0H17a2,2,0,0,1,2,2V2a0,0,0,0,1,0,0H0A0,0,0,0,1,0,2V2A2,2,0,0,1,2,0Z"
                            transform="translate(674.701 434.463)" fill="#FD545A" />
                        <rect id="Rectangle_573" data-name="Rectangle 573" width="2" height="3" rx="1"
                            transform="translate(683.701 415.463)" fill="#FD545A" />
                        <rect id="Rectangle_574" data-name="Rectangle 574" width="1.398" height="3.962" rx="0.699"
                            transform="translate(678.115 416.918) rotate(-30)" fill="#FD545A" />
                        <rect id="Rectangle_575" data-name="Rectangle 575" width="1.398" height="3.962" rx="0.699"
                            transform="matrix(0.523, -0.852, 0.852, 0.523, 674.045, 421.339)" fill="#FD545A" />
                        <rect id="Rectangle_576" data-name="Rectangle 576" width="1.398" height="3.962" rx="0.699"
                            transform="matrix(0.506, 0.862, -0.862, 0.506, 694.212, 420.343)" fill="#FD545A" />
                        <rect id="Rectangle_577" data-name="Rectangle 577" width="1.398" height="3.962" rx="0.699"
                            transform="translate(689.761 416.304) rotate(31.145)" fill="#FD545A" />
                        <rect id="Rectangle_578" data-name="Rectangle 578" width="1" height="3" rx="0.5"
                            transform="translate(672.701 427.463) rotate(-90)" fill="#FD545A" />
                        <rect id="Rectangle_579" data-name="Rectangle 579" width="1" height="3" rx="0.5"
                            transform="translate(692.701 427.463) rotate(-90)" fill="#FD545A" />
                    </g>
                </svg>
                <span>{{itemPost.emergencyEvent}}</span>
            </div>
            <div class="objective-doing" [ngStyle]="{'display': isEmptyObject(itemPost.objective) ? 'flex' : 'none'}">
                <svg class="icon-event" xmlns="http://www.w3.org/2000/svg" width="22.899" height="22.899"
                    viewBox="0 0 22.899 22.899">
                    <g id="mission" transform="translate(0)">
                        <path id="Path_3205" data-name="Path 3205"
                            d="M4.864,322.8a1.782,1.782,0,0,1,.267-1.475l3.26-4.646L6.552,314.13a.447.447,0,0,0-.726,0L.085,322.093a.447.447,0,0,0,.363.709Z"
                            transform="translate(0 -299.903)" fill="#FD545A" />
                        <path id="Path_3206" data-name="Path 3206"
                            d="M311.071,9.5V7.156h5.59a.671.671,0,0,0,.57-1.025L316.06,4.249l1.171-1.882a.671.671,0,0,0-.57-1.025h-5.59V.671a.671.671,0,1,0-1.342,0V9.5A.865.865,0,0,1,311.071,9.5Z"
                            transform="translate(-295.877)" fill="#FD545A" />
                        <path id="Path_3207" data-name="Path 3207"
                            d="M149.512,349.174l-1.6,1.492a.671.671,0,0,1-.915,0l-1.162-1.082-1.161,1.082a.671.671,0,0,1-.915,0l-1.6-1.492-4.616,6.578a.447.447,0,0,0,.366.7h15.855a.447.447,0,0,0,.366-.7Z"
                            transform="translate(-131.312 -333.558)" fill="#FD545A" />
                        <path id="Path_3208" data-name="Path 3208"
                            d="M260.934,244.4l1.161-1.082a.671.671,0,0,1,.915,0l1.162,1.082,1.292-1.177-2.545-3.626a.447.447,0,0,0-.732,0l-2.545,3.626Z"
                            transform="translate(-248.03 -228.703)" fill="#FD545A" />
                    </g>
                </svg>
                <span>{{itemPost.objective && itemPost.objective.title ? itemPost.objective.title : ''}}</span>
            </div>
        </div>
            </div>
            <div class="right">
                <control-action [isAction]="'true'"
                    [comment]="itemPost.comment && itemPost.comment.length ? itemPost.comment.length : 0 "
                    [reboon]="itemPost.repostCount ? itemPost.repostCount : 0"
                    [like]="itemPost.likeCount ? itemPost.likeCount : 0"
                    [share]="itemPost.shareCount ? itemPost.shareCount : 0" [isBlack]="'true'"
                    (submit)="postAction($event)">
                </control-action>
            </div>
        </div> -->
        <ng-container *ngIf="isNotAccess;">
            <div
                style="display: flex;height: 50pt;justify-content: space-between;align-items: center;border-top: 0.7px solid rgba(229, 229, 229, 0.7);">
                <div style="width: 6%;">
                    <!-- [matMenuTriggerFor]="menu" -->
                    <ng-container
                        *ngIf="user && user.imageURL && user.imageURL !== undefined && user.imageURL !== null && user.imageURL !== '' ; else elseImage">
                        <div class="menu-user" (click)="menuProfile();">
                            <img class="image-profile" src="{{user.imageURL}}" alt="">
                        </div>
                    </ng-container>
                    <ng-template #elseImage>
                        {{user.name}}
                        <div class="menu-user displayName"
                            *ngIf="user && user.displayName && user.displayName !== undefined && user.displayName !== null && user.displayName !== '' || user.name && user.name !== null && user.name !== '' && user.name !== undefined ">
                            <div class="donator">
                                {{ user.name || user.displayName | slice: 0:1 }}
                            </div>
                        </div>
                    </ng-template>
                </div>
            </div>
        </ng-container>

    </div>
</div>