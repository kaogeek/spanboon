<!--
    @license Spanboon Platform v0.1
    (c) 2020-2021 KaoGeek. http://kaogeek.dev
    License: MIT. https://opensource.org/licenses/MIT
    Author:  p-nattawadee <nattawdee.l@absolute.co.th>, Chanachai-Pansailom <chanachai.p@absolute.co.th>, Americaso <treerayuth.o@absolute.co.th>
-->
<div [class.active]="isActive()" role="button" class="btn-notfication" [matMenuTriggerFor]="beforeMenu"
    (menuOpened)="isNotiAll = 1">
    <div class="notiAlert" [class.active-plus]="noti!.countUnread + (notiObj && notiObj.count) > 9"
        *ngIf="noti!.countUnread + (notiObj && notiObj.count) > 0">
        <ng-container *ngIf="noti!.countUnread + (notiObj && notiObj.count) > 9; else elseTemplateNoti">
            <span>9+</span>
        </ng-container>
        <ng-template #elseTemplateNoti>
            <span>{{noti.countUnread + (notiObj && notiObj.count)}}</span>
        </ng-template>
    </div>
    <ng-container>
        <svg xmlns="http://www.w3.org/2000/svg" width="48.435" height="55.402" viewBox="0 0 48.435 55.402">
            <g id="Group_2390" data-name="Group 2390" transform="translate(1622.165 -3303.088)">
                <path id="Path_3517" data-name="Path 3517"
                    d="M329.217,126.776a2.062,2.062,0,0,1-2.063-2.063,21.527,21.527,0,0,0-6.343-15.316,2.063,2.063,0,0,1,2.908-2.909,25.612,25.612,0,0,1,7.551,18.233,2.063,2.063,0,0,1-2.063,2.063Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3518" data-name="Path 3518"
                    d="M284.9,126.892a2.062,2.062,0,0,1-2.063-2.061,25.619,25.619,0,0,1,7.55-18.232,2.063,2.063,0,1,1,3.131,2.687,1.94,1.94,0,0,1-.222.222,21.515,21.515,0,0,0-6.338,15.323,2.064,2.064,0,0,1-2.063,2.064Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3519" data-name="Path 3519"
                    d="M324.051,150.047h-34.04a6.512,6.512,0,0,1-4.234-11.457,10.916,10.916,0,0,0,3.918-8.383v-5.752a17.473,17.473,0,0,1,12.378-16.6l0-.049a4.965,4.965,0,0,1,9.918,0l0,.049a17.469,17.469,0,0,1,12.378,16.589v5.757a10.9,10.9,0,0,0,3.875,8.352h0a6.511,6.511,0,0,1-4.2,11.487m-17.016-37.233-1.646.239a11.614,11.614,0,0,0-9.89,11.407v5.747a16.693,16.693,0,0,1-5.967,12.809.707.707,0,0,0,.479,1.227h34.038a.707.707,0,0,0,.708-.706.707.707,0,0,0-.251-.541,16.677,16.677,0,0,1-5.937-12.792v-5.749a11.613,11.613,0,0,0-9.891-11.4Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3520" data-name="Path 3520"
                    d="M307.028,158.49a7.756,7.756,0,0,0,7.579-6.188H299.451a7.758,7.758,0,0,0,7.577,6.188"
                    transform="translate(-1905 3200)" fill="#474747" />
            </g>
        </svg>
    </ng-container>
    <ng-template #elseTemplateIcons>
        <ng-container>
            <svg xmlns="http://www.w3.org/2000/svg" width="47.06" height="55.402" viewBox="0 0 47.06 55.402">
                <g id="Group_493" data-name="Group 493" transform="translate(-407.878 -248.869)">
                    <g id="Path_263" data-name="Path 263">
                        <path id="Path_3640" data-name="Path 3640"
                            d="M448.428,295.828h-34.04a6.512,6.512,0,0,1-4.234-11.457,10.919,10.919,0,0,0,3.918-8.383v-5.752a17.472,17.472,0,0,1,12.378-16.6l0-.048a4.965,4.965,0,0,1,9.918,0l0,.048A17.471,17.471,0,0,1,448.75,270.23v5.758a10.892,10.892,0,0,0,3.875,8.352h0a6.512,6.512,0,0,1-4.2,11.488Z"
                            fill="#474747" />
                    </g>
                    <path id="Path_264" data-name="Path 264"
                        d="M431.4,304.271a7.757,7.757,0,0,0,7.58-6.188H423.827A7.756,7.756,0,0,0,431.4,304.271Z"
                        fill="#474747" />
                </g>
            </svg>
        </ng-container>
        <ng-template>
            <svg xmlns="http://www.w3.org/2000/svg" width="47.06" height="55.402" viewBox="0 0 47.06 55.402">
                <g id="Group_2389" data-name="Group 2389" transform="translate(1680.568 -3303.088)">
                    <path id="Path_3521" data-name="Path 3521"
                        d="M264.982,150.047h-34.04a6.512,6.512,0,0,1-4.234-11.457,10.916,10.916,0,0,0,3.918-8.383v-5.752A17.473,17.473,0,0,1,243,107.86l0-.049a4.965,4.965,0,0,1,9.918,0l0,.049A17.471,17.471,0,0,1,265.3,124.45v5.757a10.891,10.891,0,0,0,3.874,8.352h0a6.511,6.511,0,0,1-4.2,11.487m-17.016-37.233-1.646.239a11.614,11.614,0,0,0-9.89,11.407v5.747a16.693,16.693,0,0,1-5.967,12.809.707.707,0,0,0,.479,1.227H264.98a.707.707,0,0,0,.708-.706.707.707,0,0,0-.251-.541A16.681,16.681,0,0,1,259.5,130.2v-5.749a11.613,11.613,0,0,0-9.891-11.4Z"
                        transform="translate(-1905 3200)" fill="#474747" />
                    <path id="Path_3522" data-name="Path 3522"
                        d="M247.958,158.49a7.756,7.756,0,0,0,7.579-6.188H240.381a7.758,7.758,0,0,0,7.577,6.188"
                        transform="translate(-1905 3200)" fill="#474747" />
                </g>
            </svg>
        </ng-template>

    </ng-template>
</div>
<mat-menu class="wrapper-notification" #beforeMenu="matMenu" yPosition="below" backdropClass="noti-sub-menu">
    <div class="mat-menu-title" (click)="$event.stopPropagation();">
        <div class="text">การแจ้งเตือน</div>
        <div class="select-noti-list">
            <span class="list" (click)="isNotiAll !== 1 ? clickNotification(1) : null"
                [ngClass]="{'select': isNotiAll === 1 && !isRequestNoti }">
                ยังไม่ได้อ่าน ({{noti!.countUnread < 1000 ? noti!.countUnread : '999+' }}) </span>
                    <span class="list" (click)="isNotiAll !== 2 ? clickNotification(2) : null"
                        [ngClass]="{'select': isNotiAll === 2 && !isRequestNoti }">
                        ทั้งหมด ({{noti!.countAll < 1000 ? noti!.countAll : '999+' }}) </span>
                            <span class="list" (click)="clickRequestNoti()"
                                [ngClass]="{'select': isRequestNoti }">คำร้อง ({{noti.objective.length < 1000 ?
                                    (noti.objective.length) : '0' }})</span>
        </div>
    </div>
    <div *ngIf="noti.length !== 0" class="wrapper-header" (click)="$event.stopPropagation();">
        <div class="wrapper-noti" style="border-bottom: unset !important;">
            ใหม่
        </div>
        <!-- <div class="wrapper-setting">
            ดูทั้งหมด
        </div> -->
    </div>
    <div #notiScroll class="noti-sc" (scroll)="scroll($event)">
        <ng-container *ngIf="isNotiAll === 2 && !isRequestNoti">
            <notification-card *ngFor="let item of noti!.all; let i = index" [message]="item" [fullPage]="true"
                [slide]="true" (click)="clickIsRead(i)">
            </notification-card>
        </ng-container>
        <ng-container *ngIf="isNotiAll === 1 && !isRequestNoti">
            <ng-container *ngFor="let item of noti!.unread; let i = index">
                <notification-card *ngIf="item.status !== 'OBJECTIVE' && item.isRead !== true" [message]="item"
                    [fullPage]="true" [slide]="true" (click)="clickIsRead(i)">
                </notification-card>
            </ng-container>
        </ng-container>
        <ng-container
            *ngIf="isNotiAll === 1 ? (noti!.countAll >= notiOffsetAll) : (noti!.countUnread >= notiOffsetUnread)">
            <div style="height: 60px;" *ngIf="isLoading">
                <spinners></spinners>
            </div>
        </ng-container>
        <ng-container *ngIf="isRequestNoti">
            <ng-container *ngFor="let item of notiObj;let i = index">
                <notification-card [message]="item" [fullPage]="true" [slide]="true" (click)="clickIsRead(i,true)">
                </notification-card>
            </ng-container>
        </ng-container>
    </div>
</mat-menu>