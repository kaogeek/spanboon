<!--
    @license Spanboon Platform v0.1
    (c) 2020-2021 KaoGeek. http://kaogeek.dev
    License: MIT. https://opensource.org/licenses/MIT
    Author:  p-nattawadee <nattawdee.l@absolute.co.th>, Chanachai-Pansailom <chanachai.p@absolute.co.th>, Americaso <treerayuth.o@absolute.co.th>
-->

<div [class.active]="isActive()" class="btn-notfication" [matMenuTriggerFor]="beforeMenu" (menuOpened)="isOpened()">
    <div class="notiAlert" [class.active-plus]="notiisRead.length > 9" *ngIf="notiisRead.length > 0">
        <ng-container *ngIf="notiisRead.length > 9; else elseTemplateNoti">
            <span>9+</span>
        </ng-container>
        <ng-template #elseTemplateNoti>
            <span>{{notiisRead.length}}</span>
        </ng-template>
    </div>
    <ng-container *ngIf="notiisRead.length > 0; else elseTemplateIcons">
        <svg xmlns="http://www.w3.org/2000/svg" width="48.435" height="55.402" viewBox="0 0 48.435 55.402">
            <g id="Group_2390" data-name="Group 2390" transform="translate(1622.165 -3303.088)">
                <path id="Path_3517" data-name="Path 3517"
                    d="M329.217,126.776a2.062,2.062,0,0,1-2.063-2.063,21.527,21.527,0,0,0-6.343-15.316,2.063,2.063,0,0,1,2.908-2.909,25.612,25.612,0,0,1,7.551,18.233,2.063,2.063,0,0,1-2.063,2.063Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3518" data-name="Path 3518"
                    d="M284.9,126.892a2.062,2.062,0,0,1-2.063-2.061,25.619,25.619,0,0,1,7.55-18.232,2.063,2.063,0,1,1,3.131,2.687,1.94,1.94,0,0,1-.222.222,21.515,21.515,0,0,0-6.338,15.323,2.064,2.064,0,0,1-2.063,2.064Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3519" data-name="Path 3519"
                    d="M324.051,150.047h-34.04a6.512,6.512,0,0,1-4.234-11.457,10.916,10.916,0,0,0,3.918-8.383v-5.752a17.473,17.473,0,0,1,12.378-16.6l0-.049a4.965,4.965,0,0,1,9.918,0l0,.049a17.469,17.469,0,0,1,12.378,16.589v5.757a10.9,10.9,0,0,0,3.875,8.352h0a6.511,6.511,0,0,1-4.2,11.487m-17.016-37.233-1.646.239a11.614,11.614,0,0,0-9.89,11.407v5.747a16.693,16.693,0,0,1-5.967,12.809.707.707,0,0,0,.479,1.227h34.038a.707.707,0,0,0,.708-.706.707.707,0,0,0-.251-.541,16.677,16.677,0,0,1-5.937-12.792v-5.749a11.613,11.613,0,0,0-9.891-11.4Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3520" data-name="Path 3520"
                    d="M307.028,158.49a7.756,7.756,0,0,0,7.579-6.188H299.451a7.758,7.758,0,0,0,7.577,6.188"
                    transform="translate(-1905 3200)" fill="#474747" />
            </g>
        </svg>
    </ng-container>
    <ng-template #elseTemplateIcons>
        <svg xmlns="http://www.w3.org/2000/svg" width="47.06" height="55.402" viewBox="0 0 47.06 55.402">
            <g id="Group_2389" data-name="Group 2389" transform="translate(1680.568 -3303.088)">
                <path id="Path_3521" data-name="Path 3521"
                    d="M264.982,150.047h-34.04a6.512,6.512,0,0,1-4.234-11.457,10.916,10.916,0,0,0,3.918-8.383v-5.752A17.473,17.473,0,0,1,243,107.86l0-.049a4.965,4.965,0,0,1,9.918,0l0,.049A17.471,17.471,0,0,1,265.3,124.45v5.757a10.891,10.891,0,0,0,3.874,8.352h0a6.511,6.511,0,0,1-4.2,11.487m-17.016-37.233-1.646.239a11.614,11.614,0,0,0-9.89,11.407v5.747a16.693,16.693,0,0,1-5.967,12.809.707.707,0,0,0,.479,1.227H264.98a.707.707,0,0,0,.708-.706.707.707,0,0,0-.251-.541A16.681,16.681,0,0,1,259.5,130.2v-5.749a11.613,11.613,0,0,0-9.891-11.4Z"
                    transform="translate(-1905 3200)" fill="#474747" />
                <path id="Path_3522" data-name="Path 3522"
                    d="M247.958,158.49a7.756,7.756,0,0,0,7.579-6.188H240.381a7.758,7.758,0,0,0,7.577,6.188"
                    transform="translate(-1905 3200)" fill="#474747" />
            </g>
        </svg>
    </ng-template>
</div>
<mat-menu class="wrapper-notification" #beforeMenu="matMenu" yPosition="below" backdropClass="noti-sub-menu">
    <div class="wrapper-header" (click)="$event.stopPropagation();">
        <div class="wrapper-noti">
            การแจ้งเตือน
        </div>
        <div (click)="markReadNotiAll();" class="wrapper-setting">
            ตั้งค่า
        </div>
    </div>
    <div class="noti-sc">
        <ng-container *ngIf="notiOrigin && notiOrigin.length > 0 && notiOrigin !== undefined; else elseTemplateLoad">
            <div (click)="markReadNoti(item.notification.id);" *ngFor="let item of notiOrigin" class="wrapper-list">
                <a href={{item.notification.linkPath}}>
                    <div class="wrapper-list-div">
                        <ng-container
                            *ngIf="item.sender.avatarURL !== '' && item.sender.avatarURL !== undefined && item.sender.avatarURL !== null; else elseTemplateAvatar">
                            <div class="user-noti">
                                <img class="img" src={{item.sender.avatarURL}} alt="">
                            </div>
                        </ng-container>
                        <ng-template #elseTemplateAvatar>
                            <div class="user-noti">
                                <div class="img none-image">{{item.sender.displayName | slice: 0: 1}}</div>
                            </div>
                        </ng-template>
                        <div class="wrapper-message">
                            <div class="top">
                                {{item.notification.title}}
                            </div>
                            <div class="wrapper-time">
                                <svg height="512pt" viewBox="0 0 512 512" width="512pt"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="m256 512c-141.164062 0-256-114.835938-256-256s114.835938-256 256-256 256 114.835938 256 256-114.835938 256-256 256zm0-480c-123.519531 0-224 100.480469-224 224s100.480469 224 224 224 224-100.480469 224-224-100.480469-224-224-224zm0 0"
                                        fill="#A5A5A6" />
                                    <path
                                        d="m368 394.667969c-4.097656 0-8.191406-1.558594-11.308594-4.695313l-112-112c-3.007812-3.007812-4.691406-7.082031-4.691406-11.304687v-149.335938c0-8.832031 7.167969-16 16-16s16 7.167969 16 16v142.699219l107.308594 107.308594c6.25 6.25 6.25 16.382812 0 22.632812-3.117188 3.136719-7.210938 4.695313-11.308594 4.695313zm0 0 "
                                        fill="#A5A5A6" />
                                </svg>
                                <span>{{item && item.notification.createdDate | dateFormat}}</span>
                            </div>

                        </div>
                    </div>

                    <div class="wrapper-setting">
                        <svg xmlns="http://www.w3.org/2000/svg" width="5" height="21" viewBox="0 0 5 21">
                            <g id="Group_1211" data-name="Group 1211" transform="translate(-453 -178)">
                                <circle id="Ellipse_224" data-name="Ellipse 224" cx="2.5" cy="2.5" r="2.5"
                                    transform="translate(453 178)" fill="#A5A5A6" />
                                <circle id="Ellipse_225" data-name="Ellipse 225" cx="2.5" cy="2.5" r="2.5"
                                    transform="translate(453 186)" fill="#A5A5A6" />
                                <circle id="Ellipse_226" data-name="Ellipse 226" cx="2.5" cy="2.5" r="2.5"
                                    transform="translate(453 194)" fill="#A5A5A6" />
                            </g>
                        </svg>
                    </div>
                </a>
            </div>
        </ng-container>
        <ng-template #elseTemplateLoad>
            <preload-data *ngFor="let item of [0 , 1 , 2 , 3]" [isShowCard1]="true" [isShowCard2]="false"
                class="wrapper-list preload"></preload-data>
        </ng-template>


    </div>
    <div (click)="markReadNotiAll();" class="wrapper-all-footer">
        ดูทั้งหมด
    </div>
</mat-menu>