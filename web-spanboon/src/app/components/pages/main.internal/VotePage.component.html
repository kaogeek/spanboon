<div class="wrapper-vote-page">
    <div class="wrapper-left" *ngIf="!paramsKey">
        <div class="menu-wrapper">
            <p>Vote</p>
            <ng-container *ngFor="let item of menuList">
                <div *ngIf="item.isLogin === isLogin()" class="menu-box" [class.active]="activeMenu === item.status"
                    [routerLink]="!!item.status ? ['', 'vote', item.status] : ['','vote']"
                    (click)="activeMenu = item.status;changeMenu(activeMenu)">
                    <div class="icon">
                        <img [ngStyle]="{'width': item.status !== activeMenu && (item.status === 'my-vote' || item.status === 'result') ? '24px' : '16px','height': item.status !== activeMenu && (item.status === 'my-vote' || item.status === 'result') ? '24px' : '16px'}"
                            [src]="item.status === activeMenu ? item.icon2 : item.icon">
                    </div>
                    <span>{{item.name}}</span>
                </div>
            </ng-container>
        </div>
    </div>
    <div class="wrapper-right" #scrollDiv infinite-scroll [infiniteScrollDistance]="scrollDistance"
        [alwaysCallback]="true" (scrolled)="onScrollDown($event)">
        <div class="menu-wrapper" *ngIf="!paramsKey" [ngStyle]="{'top': !isRes ? '59px' : '0'}">
            <ng-container *ngFor="let item of menuList">
                <div *ngIf="item.isLogin === isLogin()" class="menu-box" [class.active]="activeMenu === item.status"
                    [routerLink]="!!item.status ? ['', 'vote', item.status] : ['','vote']"
                    (click)="activeMenu = item.status;changeMenu(activeMenu)">
                    <span [class.active]="activeMenu === item.status">{{item.name}}</span>
                </div>
            </ng-container>
        </div>
        <div class="content-wrapper">
            <div class="search-header">
                <button mat-icon-button class="button-back" *ngIf="!!paramsKey" [routerLink]="'/vote'"
                    (click)="setValueChangeMenu()">
                    <mat-icon>arrow_back</mat-icon>
                </button>
                <div class="search">
                    <label class="material-icons icon-search" for="inputSearch">
                        search
                    </label>
                    <input #inputSearch id="inputSearch" type="search" [placeholder]="'ค้นหาโหวต'">
                    <!-- (keyup.enter)="searchValue($event.target.value)" -->
                </div>
                <div class="create-vote" *ngIf="(ranking === 1) || isAllowCreate" (click)="openDialogCreateVote()">
                    <img src="../../../../assets/img/icons/votepage/create.svg">
                    <span>สร้างโหวต</span>
                </div>
            </div>

            <ng-container *ngIf="activeUrl['name'] === undefined && !isEmpty">
                <ng-container *ngIf="!!model && !!model.pin && model.pin.length > 0">
                    <div class="header-content">
                        <p>ปักหมุด</p>
                        <span (click)="changeMenu('all',false,'ปักหมุด')">ดูทั้งหมด</span>
                    </div>
                    <hr>
                    <div class="wrapper-content"
                        [ngStyle]="{'grid-template-columns': model.pin.length === 0 ? '1fr' : null}">
                        <ng-container *ngIf="model.pin.length > 0">
                            <ng-container *ngFor="let data of model.pin">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote #pinContent class="pin-content-data" [model]="data"
                                        [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>

                <ng-container *ngIf="!!model && !!model.myVote && model.myVote.length > 0">
                    <div class="header-content">
                        <p>โหวตของฉัน</p>
                        <!-- <span>ดูทั้งหมด</span> -->
                    </div>
                    <hr>
                    <div class="wrapper-content"
                        [ngStyle]="{'grid-template-columns': model.myVote.length === 0 ? '1fr' : null}">
                        <ng-container *ngIf="model.myVote.length > 0">
                            <ng-container *ngFor="let data of model.myVote">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote #pinContent class="myvote-content-data" [model]="data"
                                        [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>

                <ng-container *ngIf="!!model && !!model.closeDate && model.closeDate.length > 0">
                    <div class="header-content">
                        <p>ใกล้ปิดโหวต</p>
                        <span (click)="changeMenu('all',false,'ใกล้ปิดโหวต')">ดูทั้งหมด</span>
                    </div>
                    <hr>
                    <div class="wrapper-content"
                        [ngStyle]="{'grid-template-columns': model.closeDate.length === 0 ? '1fr' : null}">
                        <ng-container *ngIf="model.closeDate.length > 0">
                            <ng-container *ngFor="let data of model.closeDate">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote #pinContent class="support-content-data" [model]="data"
                                        [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>

                <ng-container *ngIf="!!model && !!model.closetSupport && model.closetSupport.length > 0">
                    <div class="header-content">
                        <p>ใกล้ปิดล่ารายชื่อ</p>
                        <span (click)="changeMenu('all',false,'ใกล้ปิดล่ารายชื่อ')">ดูทั้งหมด</span>
                    </div>
                    <hr>
                    <div class="wrapper-content"
                        [ngStyle]="{'grid-template-columns': model.closetSupport.length === 0 ? '1fr' : null}">
                        <ng-container *ngIf="model.closetSupport.length > 0">
                            <ng-container *ngFor="let data of model.closetSupport">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote #pinContent class="support-content-data" [model]="data"
                                        [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>

                <ng-container *ngIf="!!model && !!model.hashTagVote">
                    <ng-container *ngFor="let item of model.hashTagVote">
                        <ng-container *ngIf="item.votingEvent.length > 0">
                            <div class="header-content">
                                <p>{{item._id}}</p>
                                <span (click)="changeMenu('all',false,item._id)">ดูทั้งหมด</span>
                            </div>
                            <hr>
                            <div class="wrapper-content">
                                <ng-container *ngFor="let data of item.votingEvent">
                                    <ng-container *ngIf="data.hide">
                                        <card-content-vote #pinContent class="support-content-data" [model]="data"
                                            [title]="data.title"
                                            (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                            (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                            [image]="data.coverPageURL"></card-content-vote>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>

                <ng-container *ngIf="!!model && !!model.generalSection && model.generalSection.length > 0">
                    <div class="header-content">
                        <p>อื่นๆ</p>
                        <!-- <span (click)="changeMenu('all',false,'ใกล้ปิดล่ารายชื่อ')">ดูทั้งหมด</span> -->
                    </div>
                    <hr>
                    <div class="wrapper-content"
                        [ngStyle]="{'grid-template-columns': model.generalSection.length === 0 ? '1fr' : null}">
                        <ng-container *ngIf="model.generalSection.length > 0">
                            <ng-container *ngFor="let data of model.generalSection">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote #pinContent class="support-content-data" [model]="data"
                                        [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === undefined && isEmpty">
                <div class="header-content" *ngIf="!isSearch">
                    <p>ไม่พบรายการโหวต</p>
                </div>
                <div class="vote-not-found" *ngIf="isSearch">
                    <img src="../../../../assets/img/icons/votepage/vote-not-found.svg">
                    <span>{{isSearch ? 'ไม่พบโหวตที่เกี่ยวข้องกับ "'+ searchInputValue +'"' :
                        'ไม่พบโหวตในขณะนี้'}}</span>
                </div>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'my-vote'">
                <ng-container *ngIf="isEmpty; else elseMyVoteEmpty">
                    <div class="vote-not-found">
                        <img src="../../../../assets/img/icons/votepage/vote-not-found.svg">
                        <span>{{isSearch ? 'ไม่พบโหวตที่เกี่ยวข้องกับ "'+ searchInputValue +'"' :
                            'ไม่พบโหวตในขณะนี้'}}</span>
                    </div>
                </ng-container>
                <ng-template #elseMyVoteEmpty>
                    <ng-container *ngIf="!!voteData && !!voteData.myVote && voteData.myVote.length > 0">
                        <div class="header-content">
                            <p>โหวตที่ฉันสร้าง</p>
                            <span (click)="changeMenu('own',false,'โหวตที่ฉันสร้าง')">ดูทั้งหมด</span>
                        </div>
                        <hr>
                        <div class="wrapper-content">
                            <ng-container *ngFor="let data of voteData.myVote">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote class="support-content-data" [model]="data" [title]="data.title"
                                        (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="!!voteData && !!voteData.myVoterSupport && voteData.myVoterSupport.length > 0">
                        <div class="header-content">
                            <p>โหวตที่ฉันสร้างและเปิดล่ารายชื่ออยู่</p>
                            <span
                                (click)="changeMenu('own',false,'โหวตที่ฉันสร้างและเปิดล่ารายชื่ออยู่')">ดูทั้งหมด</span>
                        </div>
                        <hr>
                        <div class="wrapper-content">
                            <ng-container *ngFor="let data of voteData.myVoterSupport">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote class="support-content-data" [model]="data" [title]="data.title"
                                        (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="!!voteData && !!voteData.myVoted && voteData.myVoted.length > 0">
                        <div class="header-content">
                            <p>ที่ฉันเคยโหวต</p>
                            <span (click)="changeMenu('own',false,'ที่ฉันเคยโหวต')">ดูทั้งหมด</span>
                        </div>
                        <hr>
                        <div class="wrapper-content">
                            <ng-container *ngFor="let data of voteData.myVoted">
                                <ng-container *ngIf="data.votingEvent.hide">
                                    <card-content-vote class="support-content-data" [model]="data.votingEvent"
                                        [title]="data.votingEvent.title"
                                        (openDialog)="checkOpenDialog = true; openDialogPost(data.votingEvent)"
                                        (deleteVote)="deleteDataVote($event.votingEvent)"
                                        (editVote)="editVote($event.votingEvent)"
                                        [image]="data.votingEvent.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="!!voteData && !!voteData.mySupported && voteData.mySupported.length > 0">
                        <div class="header-content">
                            <p>ที่ฉันลงชื่อให้การสนับสนุน</p>
                            <span (click)="changeMenu('own',false,'ที่ฉันลงชื่อให้การสนับสนุน')">ดูทั้งหมด</span>
                        </div>
                        <hr>
                        <div class="wrapper-content">
                            <ng-container *ngFor="let data of voteData.mySupported">
                                <ng-container *ngIf="data.votingEvent.hide">
                                    <card-content-vote class="support-content-data" [model]="data.votingEvent"
                                        [title]="data.votingEvent.title"
                                        (openDialog)="checkOpenDialog = true; openDialogPost(data.votingEvent)"
                                        (deleteVote)="deleteDataVote($event.votingEvent)"
                                        (editVote)="editVote($event.votingEvent)"
                                        [image]="data.votingEvent.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </div>
                    </ng-container>
                </ng-template>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'support'">
                <div class="header-content">
                    <ng-container *ngIf="!isEmpty; else elseEmptySupport">
                        <p>{{isSearch && !!searchInputValue ? 'ค้นหาโหวต ' + '"' +searchInputValue + '"' :
                            'ล่ารายชื่อ'}}</p>
                    </ng-container>
                    <ng-template #elseEmptySupport>
                        <ng-container *ngIf="isSearch; else elseSearchSupport">
                            <p>{{'ไม่พบโหวตที่เกี่ยวข้องกับ ' + '"' +searchInputValue + '"'}}</p>
                        </ng-container>
                        <ng-template #elseSearchSupport>
                            <p>ไม่พบโหวตล่ารายชื่อ</p>
                        </ng-template>
                    </ng-template>
                </div>
                <hr *ngIf="!isEmpty">
                <div class="wrapper-content">
                    <ng-container *ngFor="let data of voteData">
                        <ng-container *ngIf="data?.status === 'support'">
                            <ng-container *ngIf="data.hide">
                                <card-content-vote #supportContent class="support-content-data" [model]="data"
                                    [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                    (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                    [image]="data.coverPageURL"></card-content-vote>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'open'">
                <div class="header-content">
                    <ng-container *ngIf="!isEmpty; else elseEmptyVote">
                        <p>{{isSearch && !!searchInputValue ? 'ค้นหาโหวต ' + '"' +searchInputValue + '"' :
                            'โหวตที่เปิดอยู่'}}</p>
                    </ng-container>
                    <ng-template #elseEmptyVote>
                        <ng-container *ngIf="isSearch; else elseSearchOpen">
                            <p>{{'ไม่พบโหวตที่เกี่ยวข้องกับ ' + '"' +searchInputValue + '"'}}</p>
                        </ng-container>
                        <ng-template #elseSearchOpen>
                            <p>ไม่พบโหวตที่เปิดอยู่</p>
                        </ng-template>
                    </ng-template>
                </div>
                <hr *ngIf="!isEmpty">
                <div class="wrapper-content">
                    <ng-container *ngFor="let data of voteData">
                        <ng-container *ngIf="data?.status === 'vote' && !data.closed">
                            <ng-container *ngIf="data.hide">
                                <card-content-vote [model]="data" [title]="data.title"
                                    (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                    (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                    [image]="data.coverPageURL"></card-content-vote>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'result'">
                <div class="header-content">
                    <ng-container *ngIf="!isEmpty; else elseEmptyClose">
                        <p>{{isSearch && !!searchInputValue ? 'ค้นหาโหวต ' + '"' +searchInputValue + '"' :
                            'ปิดโหวตแล้ว'}}</p>
                    </ng-container>
                    <ng-template #elseEmptyClose>
                        <ng-container *ngIf="isSearch; else elseSearchClose">
                            <p>{{'ไม่พบโหวตที่เกี่ยวข้องกับ ' + '"' +searchInputValue + '"'}}</p>
                        </ng-container>
                        <ng-template #elseSearchClose>
                            <p>ไม่พบโหวตที่ปิดโหวตแล้ว</p>
                        </ng-template>
                    </ng-template>
                </div>
                <hr *ngIf="!isEmpty">
                <div class="wrapper-content">
                    <ng-container *ngFor="let data of voteData">
                        <ng-container *ngIf="data.closed">
                            <ng-container *ngIf="data.hide">
                                <card-content-vote #myVoteContent class="myvote-content-data" [model]="data"
                                    [title]="data.title" (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                    (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                    [image]="data.coverPageURL"></card-content-vote>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'own'">
                <div class="header-content">
                    <p>{{paramsKey}}</p>
                </div>
                <hr>
                <div class="wrapper-content">
                    <ng-container *ngIf="!!model && model[typeAll]?.length > 0">
                        <ng-container *ngIf="typeAll === 'myVoted' || typeAll === 'mySupported'; else elseMyVotedOwn">
                            <ng-container *ngFor="let data of model[typeAll]">
                                <ng-container *ngIf="data.votingEvent.hide">
                                    <card-content-vote class="pin-content-data" [model]="data.votingEvent"
                                        [title]="data.votingEvent.title"
                                        (openDialog)="checkOpenDialog = true; openDialogPost(data.votingEvent)"
                                        (deleteVote)="deleteDataVote($event.votingEvent)"
                                        (editVote)="editVote($event.votingEvent)"
                                        [image]="data.votingEvent.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                        <ng-template #elseMyVotedOwn>
                            <ng-container *ngFor="let data of model[typeAll]">
                                <ng-container *ngIf="data.hide">
                                    <card-content-vote class="pin-content-data" [model]="data" [title]="data.title"
                                        (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                        (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                        [image]="data.coverPageURL"></card-content-vote>
                                </ng-container>
                            </ng-container>
                        </ng-template>
                    </ng-container>
                </div>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'all' && !isHashTagAll">
                <div class="header-content">
                    <p>{{paramsKey}}</p>
                </div>
                <hr>
                <div class="wrapper-content">
                    <ng-container *ngIf="!!model && model[typeAll]?.length > 0">
                        <ng-container *ngFor="let data of model[typeAll]">
                            <ng-container *ngIf="data.hide">
                                <card-content-vote class="pin-content-data" [model]="data" [title]="data.title"
                                    (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                    (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                    [image]="data.coverPageURL"></card-content-vote>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>

            <ng-container *ngIf="activeUrl['name'] === 'all' && isHashTagAll">
                <ng-container *ngIf="!!model && !!model.hashTagVote">
                    <ng-container *ngFor="let item of model.hashTagVote">
                        <ng-container *ngIf="item._id === paramsKey">
                            <div class="header-content">
                                <p>{{item._id}}</p>
                                <span (click)="changeMenu('all',false,item._id)">ดูทั้งหมด</span>
                            </div>
                            <hr>
                            <div class="wrapper-content">
                                <ng-container *ngFor="let data of item.votingEvent">
                                    <ng-container *ngIf="data.hide">
                                        <card-content-vote class="support-content-data" [model]="data"
                                            [title]="data.title"
                                            (openDialog)="checkOpenDialog = true; openDialogPost(data)"
                                            (deleteVote)="deleteDataVote($event)" (editVote)="editVote($event)"
                                            [image]="data.coverPageURL"></card-content-vote>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
        </div>
    </div>
</div>

<loading *ngIf="isLoading"></loading>